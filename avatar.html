<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Clarity Interview Avatar</title>
<style>
  :root{
    --c1:#60a5fa; /* blue */
    --c2:#34d399; /* green */
    --c3:#a78bfa; /* violet */
    --white:#ffffff;
  }
  html,body{height:100%}
  /* ✨ komplett transparent – „frei schwebend“ */
  body{
    margin:0;
    background:transparent;
    color:var(--white);
    font:15px/1.4 ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial;
    display:grid; place-items:center;
    overflow:hidden;
  }

  /* Bühne ohne Hintergrund */
  .stage{
    position:relative;
    width:340px; height:340px;
    pointer-events:none;  /* sauber im iFrame */
    transform-style:preserve-3d;
  }

  /* 3D Kugel – mehrere Layer für Tiefe + Glow */
  .sphere{
    --size: 180px;
    position:absolute; inset:0; margin:auto;
    width:var(--size); height:var(--size);
    border-radius:50%;
    background:
      radial-gradient(120% 120% at 35% 30%, rgba(255,255,255,.9), rgba(255,255,255,.45) 25%, rgba(255,255,255,0) 40%),
      radial-gradient(90% 90% at 60% 65%, rgba(255,255,255,.15), rgba(255,255,255,0) 60%),
      radial-gradient(60% 60% at 50% 50%, #192537, #0b1522);
    box-shadow:
      0 10px 30px rgba(0,0,0,.35),
      0 0 60px 20px rgba(96,165,250,.25),
      0 0 120px 40px rgba(167,139,250,.15);
    animation: float 5s ease-in-out infinite;
  }

  /* farbige Aura, pulsiert */
  .aura, .aura2{
    position:absolute; inset:0; margin:auto;
    width:250px; height:250px; border-radius:50%;
    filter:blur(18px);
    background:conic-gradient(from 210deg, var(--c1), var(--c2), var(--c3), var(--c1));
    opacity:.65;
    animation: breathe 3.2s ease-in-out infinite;
  }
  .aura2{
    width:310px; height:310px; opacity:.35; filter:blur(28px);
    animation-duration:4.6s;
  }

  /* zarte Wellenringe */
  .ring{position:absolute; inset:0; margin:auto; border-radius:50%; border:2px solid transparent}
  .r1{width:220px;height:220px; box-shadow:0 0 0 2px rgba(96,165,250,.7) inset}
  .r2{width:280px;height:280px; box-shadow:0 0 0 2px rgba(52,211,153,.6) inset}
  .r3{width:340px;height:340px; box-shadow:0 0 0 2px rgba(167,139,250,.55) inset}
  .r1,.r2,.r3{animation: pulse 2.6s ease-in-out infinite}

  /* Status-Badge (optional) */
  .badge{
    position:absolute; left:50%; bottom:-10px; translate:-50% 100%;
    font-size:12px; font-weight:700; letter-spacing:.2px;
    padding:6px 10px; border-radius:999px;
    color:#e9f2ff; background:rgba(13,22,34,.55); backdrop-filter:blur(6px);
    border:1px solid rgba(255,255,255,.14);
  }

  @keyframes float{0%,100%{transform:translateY(-6px)}50%{transform:translateY(6px)}}
  @keyframes breathe{0%,100%{transform:scale(1)}50%{transform:scale(1.08)}}
  @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.06)}}

  /* dynamische States */
  .listening .aura{animation-duration:2.2s}
  .listening .r1,.listening .r2,.listening .r3{animation-duration:2.1s}
  .speaking  .aura{animation-duration:1.6s}
  .speaking  .r1,.speaking  .r2,.speaking  .r3{animation-duration:1.6s}
  .thinking  .aura{animation-duration:3.2s}
  .thinking  .r1,.thinking  .r2,.thinking  .r3{animation-duration:3.0s}
</style>
</head>
<body>
  <div class="stage" id="stage">
    <div class="aura2"></div>
    <div class="aura"></div>
    <div class="sphere" id="ball"></div>
    <div class="ring r3"></div>
    <div class="ring r2"></div>
    <div class="ring r1"></div>
    <div class="badge" id="badge">idle</div>
  </div>

<script>
(function(){
  const stage = document.getElementById('stage');
  const ball  = document.getElementById('ball');
  const badge = document.getElementById('badge');

  // Parallax für „3D-Gefühl“
  const cx = window.innerWidth/2, cy = window.innerHeight/2;
  window.addEventListener('mousemove', (e)=>{
    const dx = (e.clientX - cx) / cx, dy = (e.clientY - cy) / cy;
    stage.style.transform = `rotateX(${dy*6}deg) rotateY(${dx*-8}deg)`;
  });

  // API wie gehabt:
  function setState(s){
    badge.textContent = s || 'idle';
    stage.classList.remove('listening','speaking','thinking');
    if(s) stage.classList.add(s);
  }
  function setLevel(v){
    const c = Math.max(0, Math.min(1, Number(v)||0));
    const scale = 1 + c*0.25;
    ball.style.transform = `scale(${scale})`;
    ball.style.boxShadow =
      `0 10px 30px rgba(0,0,0,.35),
       0 0 ${60+100*c}px ${20+40*c}px rgba(96,165,250,.25),
       0 0 ${120+120*c}px ${40+50*c}px rgba(167,139,250,.18)`;
  }

  window.addEventListener('message', ev=>{
    const d = ev.data || {};
    if(d.type==='avatar:set')   setState(d.state||'idle');
    if(d.type==='avatar:level') setLevel(d.value);
    if(d.type==='ping') ev.source?.postMessage?.({type:'avatar:ready'}, '*');
  });

  setTimeout(()=> parent?.postMessage?.({type:'avatar:ready'},'*'), 40);
})();
</script>
</body>
</html>
