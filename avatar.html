<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Clarity Avatar – Glass Sphere</title>
<style>
  :root{
    --c1:#60a5fa; /* blue  */
    --c2:#34d399; /* green */
    --c3:#f472b6; /* pink  */
    --c4:#a78bfa; /* violet*/
    --dur:2.6s;   /* breathing speed (state) */
    --boost:1;    /* level intensity (set via JS) */
  }
  html,body{height:100%}
  /* komplett transparent – freischwebend */
  body{
    margin:0; background:transparent; overflow:hidden;
    display:grid; place-items:center;
    font:14px/1.4 ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial;
    color:#eaf2ff;
  }

  .stage{
    position:relative; width:360px; height:360px; transform-style:preserve-3d;
    pointer-events:none;
  }

  /* weiche, farbige Aura (kein Hintergrund) */
  .aura{
    position:absolute; inset:0; margin:auto;
    width:320px; height:320px; border-radius:50%;
    background:
      radial-gradient(45% 45% at 30% 35%, rgba(255,255,255,.35), rgba(255,255,255,0) 60%),
      radial-gradient(60% 60% at 70% 65%, rgba(255,255,255,.12), rgba(255,255,255,0) 70%),
      conic-gradient(from 210deg, var(--c1), var(--c2), var(--c3), var(--c4), var(--c1));
    filter:blur(26px) saturate(1.05);
    opacity:.55;
    animation:breathe var(--dur) ease-in-out infinite;
    transform:scale(calc(1 * var(--boost)));
  }

  /* die Glas-Kugel */
  .sphere{
    position:absolute; inset:0; margin:auto;
    width:200px; height:200px; border-radius:50%;
    /* etwas „Glas“: innen hell, unten dunkler, dezente Kante */
    background:
      radial-gradient(110% 110% at 35% 28%, rgba(255,255,255,.9), rgba(255,255,255,.35) 22%, rgba(255,255,255,0) 40%),
      radial-gradient(70% 70% at 60% 65%, rgba(255,255,255,.12), rgba(0,0,0,0) 60%),
      radial-gradient(65% 65% at 50% 50%, #132034, #0a1523 65%, #07111b 100%);
    box-shadow:
      inset 0 18px 34px rgba(255,255,255,.35),
      inset 0 -36px 70px rgba(0,0,0,.65),
      0 10px 28px rgba(0,0,0,.45),
      0 0 calc(90px * var(--boost)) calc(26px * var(--boost)) rgba(167,139,250,.16);
    animation:float 5s ease-in-out infinite;
    transform:scale(calc(1 + 0.08*(var(--boost) - 1)));
  }

  /* irisierende „Siri“-Farbwolke im Inneren */
  .swirl{
    position:absolute; inset:-18%; border-radius:50%;
    background:conic-gradient(from 0deg,
      rgba(96,165,250,.85),
      rgba(52,211,153,.9),
      rgba(244,114,182,.9),
      rgba(167,139,250,.9),
      rgba(96,165,250,.85));
    filter:blur(16px) saturate(1.15);
    mix-blend-mode:screen;
    opacity:.95;
    animation:swirl 14s linear infinite;
    /* nur im Inneren sichtbar lassen */
    -webkit-mask:radial-gradient(circle at 50% 50%, #000 60%, transparent 72%);
            mask:radial-gradient(circle at 50% 50%, #000 60%, transparent 72%);
    transform:scale(calc(1.02 * var(--boost)));
  }

  /* glänzender Reflex auf dem Glas */
  .shine{
    position:absolute; inset:0; margin:auto; width:200px; height:200px; border-radius:50%;
    background:
      radial-gradient(120% 60% at 20% 18%, rgba(255,255,255,.55), rgba(255,255,255,.12) 35%, rgba(255,255,255,0) 60%),
      radial-gradient(80% 50% at 75% 80%, rgba(255,255,255,.12), rgba(255,255,255,0) 60%);
    mix-blend-mode:screen; pointer-events:none;
    transform:translateZ(1px);
  }

  /* dezentes Badge (optional) */
  .badge{
    position:absolute; left:50%; bottom:-8px; translate:-50% 100%;
    font-weight:700; padding:6px 10px; border-radius:999px;
    background:rgba(10,18,28,.5); border:1px solid rgba(255,255,255,.14);
    backdrop-filter:blur(6px); -webkit-backdrop-filter:blur(6px);
  }

  /* Animations */
  @keyframes float{0%,100%{transform:translateY(-6px)}50%{transform:translateY(6px)}}
  @keyframes breathe{0%,100%{transform:scale(calc(1 * var(--boost)))}50%{transform:scale(calc(1.08 * var(--boost)))}}
  @keyframes swirl{to{transform:rotate(360deg) scale(calc(1.02 * var(--boost)));}}

  /* State-Speeds */
  .listening { --dur:2.1s; }
  .speaking  { --dur:1.6s; }
  .thinking  { --dur:3.2s; }
</style>
</head>
<body>
  <div class="stage" id="stage">
    <div class="aura"  id="aura"></div>
    <div class="sphere" id="sphere">
      <div class="swirl" id="swirl"></div>
      <div class="shine"></div>
    </div>
    <div class="badge" id="badge">idle</div>
  </div>

<script>
(function(){
  const stage = document.getElementById('stage');
  const badge = document.getElementById('badge');

  // leichter Parallax für Tiefe
  const cx = window.innerWidth/2, cy = window.innerHeight/2;
  window.addEventListener('mousemove', (e)=>{
    const dx = (e.clientX - cx) / cx, dy = (e.clientY - cy) / cy;
    stage.style.transform = `rotateX(${dy*6}deg) rotateY(${dx*-8}deg)`;
  });

  function setState(s){
    badge.textContent = s || 'idle';
    stage.classList.remove('listening','speaking','thinking');
    if(s) stage.classList.add(s);
  }
  function setLevel(v){
    const c = Math.max(0, Math.min(1, Number(v) || 0));
    // boost treibt Glow/Skalierung in CSS
    stage.style.setProperty('--boost', (1 + 0.6*c).toFixed(3));
  }

  // Messaging API wie gehabt
  window.addEventListener('message', ev=>{
    const d = ev.data || {};
    if(d.type==='avatar:set')   setState(d.state||'idle');
    if(d.type==='avatar:level') setLevel(d.value);
    if(d.type==='ping') ev.source?.postMessage?.({type:'avatar:ready'}, '*');
  });

  setTimeout(()=> parent?.postMessage?.({type:'avatar:ready'},'*'), 40);
})();
</script>
</body>
</html>
